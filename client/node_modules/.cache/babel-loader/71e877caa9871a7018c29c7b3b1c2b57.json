{"ast":null,"code":"import _toConsumableArray from \"/Users/nicklascschmidt/Code/Nicky/threadauction/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/Users/nicklascschmidt/Code/Nicky/threadauction/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/nicklascschmidt/Code/Nicky/threadauction/client/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/nicklascschmidt/Code/Nicky/threadauction/client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/nicklascschmidt/Code/Nicky/threadauction/client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/nicklascschmidt/Code/Nicky/threadauction/client/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/nicklascschmidt/Code/Nicky/threadauction/client/src/pages/orderHistory/orderHistory.js\";\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport PrettyProfile from './orderHistoryStyles';\nimport './orderHistory-style.css';\nimport axios from 'axios';\nimport ProductListingProfile from \"../../components/productListing/productListingProfile\";\nimport { calculateCreatedAt, calculateTimeRemaining, showDurationTimeRemaining } from '../../components/timeConverter/timeConverter';\n\nvar OrderHistory =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(OrderHistory, _React$Component);\n\n  function OrderHistory(props) {\n    var _this;\n\n    _classCallCheck(this, OrderHistory);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(OrderHistory).call(this, props));\n\n    _this.componentDidMount = function () {\n      _this.setState({\n        userId: _this.props.userId,\n        username: _this.props.username,\n        bidArray: [],\n        // every bid the user has cast\n        auctionArray: [],\n        errorArray: [],\n        isError: null\n      }, function () {\n        _this.pullBidsFromDb(_this.state.userId);\n      });\n    };\n\n    _this.pullBidsFromDb = function (userId) {\n      console.log('Pulling users bids from the DB with this ID: ', userId);\n      var params = {\n        userId: userId\n      };\n      axios.get('/api/bid/auctionBids', {\n        params: params\n      }).then(function (resp) {\n        _this.setState({\n          bidArray: resp.data\n        }, function () {\n          console.log('These are all the bids the user has placed: ', _this.state.bidArray);\n\n          _this.getAuctionIds(_this.state.bidArray);\n        });\n      }).catch(function (err) {\n        console.log(err);\n      });\n    };\n\n    _this.displayBids = function (bidArray, auctionIdArray) {\n      // console.log('displaying bids...',bidArray);\n      var bidArrayMapped = bidArray.map(function (bid) {\n        // console.log('bid',bid);\n        return React.createElement(\"div\", {\n          key: bid.id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 80\n          },\n          __self: this\n        }, React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 81\n          },\n          __self: this\n        }, \"Bid Amount: $\", bid.bidAmount), React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 82\n          },\n          __self: this\n        }, \"Bid Submitted At: \", calculateCreatedAt(bid.bidSubmitTime)), React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 83\n          },\n          __self: this\n        }, \"Auction ID: \", bid.AuctionId));\n      });\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 87\n        },\n        __self: this\n      }, bidArrayMapped);\n    };\n\n    _this.state = {\n      userId: '',\n      username: '',\n      bidArray: [],\n      auctionIdArray: [],\n      auctionArray: [],\n      errorArray: [],\n      isError: null\n    };\n    return _this;\n  }\n\n  _createClass(OrderHistory, [{\n    key: \"getAuctionIds\",\n    value: function getAuctionIds(bidArray) {\n      var _this2 = this;\n\n      console.log('getting auction IDs...');\n      var auctionIdArray = [];\n      bidArray.map(function (bid) {\n        auctionIdArray.push(bid.AuctionId);\n      });\n\n      var removeDupes = function removeDupes(a) {\n        return _toConsumableArray(new Set(a));\n      };\n\n      var removeDupeArray = removeDupes(auctionIdArray);\n      this.setState({\n        auctionIdArray: removeDupeArray\n      }, function () {\n        console.log('These are the IDs of the auctions: ', _this2.state.auctionIdArray);\n\n        _this2.loopAuctionsForProductInfo(_this2.state.auctionIdArray);\n      });\n    }\n  }, {\n    key: \"loopAuctionsForProductInfo\",\n    value: function loopAuctionsForProductInfo(auctionIdArray) {\n      var _this3 = this;\n\n      console.log('Now, we\\'re looping through the auction array and pulling data for each one. We\\'ll map it after.');\n      var bidPromises = [];\n\n      var _loop = function _loop(n) {\n        bidPromises.push(new Promise(function (resolve, reject) {\n          _this3.fetchAuctionFromDb(auctionIdArray[n]).then(function (resp) {\n            resolve(resp.data);\n          }).catch(function (err) {\n            reject(err);\n          });\n        }));\n      };\n\n      for (var n = 0; n < auctionIdArray.length; n++) {\n        _loop(n);\n      }\n\n      Promise.all(bidPromises).then(function (bidPromiseData) {\n        var filteredArray = bidPromiseData.filter(function (value) {\n          return value != '';\n        });\n\n        _this3.setState({\n          auctionArray: filteredArray\n        }, function () {\n          console.log(\"auctionArray has been set: \", _this3.state.auctionArray);\n        });\n      }).catch(function (err) {\n        console.log('an error occurred: ', err);\n      });\n    } // Returns a promise\n\n  }, {\n    key: \"fetchAuctionFromDb\",\n    value: function fetchAuctionFromDb(auctionId) {\n      var params = {\n        auctionId: auctionId\n      };\n      return axios.get('/api/auction/id', {\n        params: params\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(PrettyProfile, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 128\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129\n        },\n        __self: this\n      }, React.createElement(\"h2\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130\n        },\n        __self: this\n      }, \"My Order History\"), this.state.bidArray.length > 0 ? React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132\n        },\n        __self: this\n      }, this.displayBids(this.state.bidArray)) : React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132\n        },\n        __self: this\n      }, \"No bids to show.\")));\n    }\n  }]);\n\n  return OrderHistory;\n}(React.Component);\n\nfunction mapStateToProps(state) {\n  console.log('OrderHistory: mapStateToProps state', state);\n  return {\n    username: state.username,\n    userId: state.userId,\n    isLoggedIn: true\n  };\n}\n\nexport default connect(mapStateToProps)(OrderHistory);","map":{"version":3,"sources":["/Users/nicklascschmidt/Code/Nicky/threadauction/client/src/pages/orderHistory/orderHistory.js"],"names":["React","connect","PrettyProfile","axios","ProductListingProfile","calculateCreatedAt","calculateTimeRemaining","showDurationTimeRemaining","OrderHistory","props","componentDidMount","setState","userId","username","bidArray","auctionArray","errorArray","isError","pullBidsFromDb","state","console","log","params","get","then","resp","data","getAuctionIds","catch","err","displayBids","auctionIdArray","bidArrayMapped","map","bid","id","bidAmount","bidSubmitTime","AuctionId","push","removeDupes","a","Set","removeDupeArray","loopAuctionsForProductInfo","bidPromises","n","Promise","resolve","reject","fetchAuctionFromDb","length","all","bidPromiseData","filteredArray","filter","value","auctionId","Component","mapStateToProps","isLoggedIn"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { connect } from 'react-redux';\nimport PrettyProfile from './orderHistoryStyles';\nimport './orderHistory-style.css';\nimport axios from 'axios';\nimport ProductListingProfile from \"../../components/productListing/productListingProfile\";\nimport { calculateCreatedAt, calculateTimeRemaining, showDurationTimeRemaining } from '../../components/timeConverter/timeConverter';\n\nclass OrderHistory extends React.Component {\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            userId: '',\n            username: '',\n            bidArray: [],\n            auctionIdArray: [],\n            auctionArray: [],\n\n            errorArray: [],\n            isError: null\n        }\n    }\n\n    componentDidMount = () => {\n        this.setState({\n            userId: this.props.userId,\n            username: this.props.username,\n            bidArray: [], // every bid the user has cast\n            auctionArray: [],\n\n            errorArray: [],\n            isError: null\n        }, () => {\n            this.pullBidsFromDb(this.state.userId);\n        })\n    }\n\n    \n    pullBidsFromDb = (userId) => {\n        console.log('Pulling users bids from the DB with this ID: ',userId);\n        const params = { userId };\n        axios.get('/api/bid/auctionBids', { params })\n        .then(resp => {\n            this.setState({\n                bidArray: resp.data,\n            }, () => {\n                console.log('These are all the bids the user has placed: ',this.state.bidArray);\n                this.getAuctionIds(this.state.bidArray);\n            })\n        }).catch(err => {\n            console.log(err);\n        });\n    }\n\n    getAuctionIds(bidArray) {\n        console.log('getting auction IDs...');\n        let auctionIdArray = [];\n        bidArray.map( (bid) => {\n            auctionIdArray.push(bid.AuctionId);\n        })\n        let removeDupes = (a) => [...new Set(a)];\n        const removeDupeArray = removeDupes(auctionIdArray);\n\n        this.setState({\n            auctionIdArray: removeDupeArray\n        }, () => {\n          console.log('These are the IDs of the auctions: ',this.state.auctionIdArray);\n          this.loopAuctionsForProductInfo(this.state.auctionIdArray);\n        })\n    }\n    \n\n    displayBids = (bidArray,auctionIdArray) => {\n        // console.log('displaying bids...',bidArray);\n\n        const bidArrayMapped = bidArray.map( (bid) => {\n            // console.log('bid',bid);\n            return (\n                <div key={bid.id}>\n                    <p>Bid Amount: ${bid.bidAmount}</p>\n                    <p>Bid Submitted At: {calculateCreatedAt(bid.bidSubmitTime)}</p>\n                    <p>Auction ID: {bid.AuctionId}</p>\n                </div>\n            )\n        })\n        return <div>{bidArrayMapped}</div>\n    }\n\n    loopAuctionsForProductInfo(auctionIdArray) {\n        console.log('Now, we\\'re looping through the auction array and pulling data for each one. We\\'ll map it after.');\n    \n        const bidPromises = [];\n        for (let n=0; n<auctionIdArray.length; n++) {\n          bidPromises.push(new Promise( (resolve, reject) => {\n            this.fetchAuctionFromDb(auctionIdArray[n])\n              .then(resp => {\n                resolve(resp.data);\n              }).catch(err => {\n                reject(err);\n              })\n          }))\n        }\n    \n        Promise.all(bidPromises).then(bidPromiseData => {\n          const filteredArray = bidPromiseData.filter( (value) => {\n            return value != '';\n          })\n          this.setState({\n            auctionArray: filteredArray\n          }, () => {\n            console.log(\"auctionArray has been set: \",this.state.auctionArray);\n          })\n        }).catch(err => {\n          console.log('an error occurred: ',err);\n        })\n    }\n\n    // Returns a promise\n    fetchAuctionFromDb(auctionId) {\n        const params = { auctionId };\n        return axios.get('/api/auction/id', { params })\n    }\n    \n    \n    render() {\n        return(\n            <PrettyProfile>\n                <div>\n                    <h2>My Order History</h2>\n                    \n                    {this.state.bidArray.length > 0 ? <div>{this.displayBids(this.state.bidArray)}</div> : <p>No bids to show.</p>}\n\n                </div>\n            </PrettyProfile>\n        )\n    }\n}\n\nfunction mapStateToProps(state) {\n    console.log('OrderHistory: mapStateToProps state',state);\n    return {\n      username: state.username,\n      userId: state.userId,\n      isLoggedIn: true\n    };\n}\n\nexport default connect(mapStateToProps)(OrderHistory);\n"]},"metadata":{},"sourceType":"module"}